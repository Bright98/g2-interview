# G2 interview project

## requirements
- `mongo db`: active on port: [27017](mongodb://127.0.0.1:27017)
- `rebbitmq`: active on port [5672](amqp://guest:guest@localhost:5672)
- `redis db`: active on port [6379](http://localhost:6379)

> **make sure these ports are free**

- project run on these ports:
- api-gateway: `9000`
- user service: `9001`
- todo service: `9002`
- authentication/sso service: `9003`
- authentication/idp service: `9004`

## توضیحات

پروژه از 4 سرویس `api-gateway`، `user`، `todo` و `authentication` تشکیل شده است.
سرویس `authentication` شامل دو میکروسرویس `idp` و `sso` میباشد.

در ادامه به توضیح هر یک از سرویس ها پرداخته شده است:

****
### user
از دیتابیس mongo برای ذخیره داده های کاربران استفاده شده است.

سرویس شامل api های CRUD برای درج، ویرایش، حذف، دریافت جزئیات کاربر و دریافت لیست کاربران میباشد.
ویرایش، حذف و دریافت جزئیات کاربر از طریق `sso_token` که از طریق `header: Authorization` ارسال میشود، قابل استفاده هستند.
درج و دریافت لیست کاربران بدون احراز هویت قابل انجام است.

****
### todo
از دیتابیس mongo برای ذخیره داده ها استفاده شده است.

تمامی API ها نیاز به احراز هویت دارند و `ss_token` از طریق `header:Authorization` ارسال میشود.

سرویس شامل API های CRUD برای درج، ویرایش، حذف، دریافت جزئیات و دریافت لیست todo-list ها و todo-item های هرلیست میباشد.

هر todo-list و todo-item به ازای هرکاربر ایجاد میشود.

****
### authentication

#### idp:
 
این سرویس وظیفه عملیات مربوط به لاگین کاربر و صدور توکن idp را به عهده دارد.
توکن idp دربرگیرنده اطلاعات مربوط به کاربر در قسمت claim و expire date میباشد.

برای توکن idp از استاندارد `jwt` استفاده شده است.
این توکن تنها برای احراز هویت استفاده میشود و دراختیار کاربر قرار نمیگیرد.

#### sso:
 
این سرویس مسئولیت احراز هویت کاربران استفاده کننده از API ها را به عهده دارد.

پس از انجام عملیات لاگین توسط سرویس idp، توکن sso توسط این سرویس ایجاد میشود.
توکن sso به همراه توکن idp در دیتابیس redis ذیخیره میشود.

برای توکن sso از `uuid` استفاده شده است.

احراز هویت سرویس و API های نیازمند احراز هویت، از طریق این سرویس انجام میشود.
کاربر با ارسال sso_token در هدر API، مجوز استفاده از API را ارسال میکند.
سرویس sso از طریق sso_token ارسالی، به idp token دسترسی پیدامیکند. و از طریق idp token اطلاعات کاربر و انقضای توکن را بررسی مینماید.

****
### api-gateway

این سرویس از طریق `Restful API` ارتباط کاربر با سایر سرویس ها را فراهم میکند.
تمامی سرویس ها توسط `Grpc API` یا `message` باهم در ارتباط هستند. لذا این سرویس وظیفه برقراری ارتباط سرویسها با کلاینت را فراهم میکند.

همچنین API هایی که نیاز به احراز هویت دارند، پیش از برقراری ارتباط با API سرویس مورد نظر، توسط سرویس sso احراز هویت میشوند و در صورت موفق بودن، به داده های سرویس خود دسترسی پیدا میکنند.
در صورتی که احراز هویت موفق نباشد، خطای کد `401` برگردانده میشود.

برای API های از جنس command پس از احراز هویت، پیام از طریق rabbitmq برای سرویس ارسال میشود.
همچنین ارتباط API های query (مانند دریافت کاربران، لیست یا جزئیات todo ها) از طریق grpc-client ها برقرار میشود.

برای بررسی خطای پیش آمده هنگام انجام عملیات command (مانند درج، ویرایش یا حذف) سرویس های user و todo دارای `collection: error_logs` در دیتابیس خود هستند. خطاهای پیش آمده از طریق دیتابیس قابل مشاهده هستند.

## در ادامه
پوشه proto شامل تمامی مدل های مربوط به grpc سرویس هاست.